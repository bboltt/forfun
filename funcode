import matplotlib.pyplot as plt
import seaborn as sns

# 1. Aggregate the data
risk_stats = df.groupby('relat_age_bin')[label_col].agg(['count', 'mean']).reset_index()
risk_stats.columns = ['relat_age_bin', 'volume', 'bad_rate']

# 2. Setup Dual Axis Plot
fig, ax1 = plt.subplots(figsize=(12, 6))

# Bar plot for Volume (Count) on left Y-axis
sns.barplot(data=risk_stats, x='relat_age_bin', y='volume', alpha=0.6, color='lightgray', ax=ax1)
ax1.set_ylabel('Population Count (Volume)', color='gray')
ax1.tick_params(axis='y', labelcolor='gray')

# Line plot for Bad Rate (Risk) on right Y-axis
ax2 = ax1.twinx()
sns.lineplot(data=risk_stats, x='relat_age_bin', y='bad_rate', marker='o', color='red', linewidth=2, ax=ax2)
ax2.set_ylabel('Fraud Rate', color='red')
ax2.tick_params(axis='y', labelcolor='red')

# Formatting
ax2.set_ylim(0, risk_stats['bad_rate'].max() * 1.2) # Scale to make room for dots
plt.title('Fraud Risk vs. Population Volume by Relationship Length')
ax1.set_xticklabels(ax1.get_xticklabels(), rotation=45)

plt.show()
